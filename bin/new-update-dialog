#!/usr/bin/env python

# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# Checks for updates of packages that are maintained by Kano
#
from kano_updater.utils import get_update_status
from kano.gtk3 import kano_dialog
import os


new_update = False
try:
    new_update = get_update_status()['update_available'] == 1
except Exception:
    pass

if new_update:
    kdialog = kano_dialog.KanoDialog("Updates available!", "Keep system fresh by updating",
                                     {"LATER": {"color": "grey", "return_value": 0}, "UPDATE NOW": {"color": "orange", "return_value": 1}})
    kdialog.set_action_background("grey")
    response = kdialog.run()

    if response == 1:
        os.popen("sudo kano-updater -f")
